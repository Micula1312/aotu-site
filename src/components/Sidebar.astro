---
const base = import.meta.env.BASE_URL || '/';
const links = [
  { href: base, label: 'home' },
  { href: base + 'abstract', label: 'abstract' },
  { href: base + 'manifesto', label: 'manifesto' },
  { href: base + 'archive', label: 'online platform' },
  { href: base + 'network', label: 'network' },
  { href: '#hardware', label: 'hardware treehouse' },
  { href: '#logs', label: 'performative logs' },
  { href: '#narratives', label: 'narrative modes' },
  { href: '#dump', label: 'editorial dump' },
];

// normalizza per confronto
const current = Astro.url.pathname.endsWith('/') ? Astro.url.pathname.slice(0, -1) : Astro.url.pathname;
function isActive(href) {
  const h = href.endsWith('/') ? href.slice(0, -1) : href;
  return h === '' ? current === '' : current === h;
}
---

<aside class="index" aria-label="Site index">
  <!-- Titlebar stile Win ’90 -->
  <div class="winbar">
    <p class="title">A#U — index</p>
    <div class="controls" aria-hidden="true">
      <span class="dot" title="minimize"></span>
      <span class="dot" title="maximize"></span>
      <span class="dot" title="close"></span>
    </div>
  </div>

  <!-- Lista indice scrollabile -->
<nav class="index-list" aria-label="Sections">
  {links.map((l) => {
    const active = isActive(l.href);
    return (
      <a
        class={`node${active ? ' is-active' : ''}`}
        href={l.href}
        aria-current={active ? 'page' : undefined}
      >
        {l.label}
      </a>
    );
  })}
</nav>

  <!-- Toolbar (opzionale) -->
  <div class="controls" style="padding:10px">
    <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
      <span class="muted">theme</span>
      <button id="themeBtn" class="chip" aria-pressed="false">terminal</button>
    </div>
    <button id="audioBtn" type="button" class="btn">[ unmute ]</button>
  </div>
</aside>
