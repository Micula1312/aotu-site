---
import Sidebar from "@/components/Sidebar.astro";
import "@/styles/terminal.css";
import soundFile from "@/assets/audio/soundscape.mp3";
import coreScriptUrl from "@/scripts/core.js?url";

const { title = "AOTU", current = "" } = Astro.props;

// Risolvi lato build (non nel browser)
const WP_BASE = import.meta.env.PUBLIC_WP_API_URL
  ? String(import.meta.env.PUBLIC_WP_API_URL).replace(/\/$/, "")
  : "";
const WP_API_URL = WP_BASE ? `${WP_BASE}/wp-json` : "";
---
<html lang="en">
  <head>
    <!-- Preload audio: solo in prod (in dev può dare warning) -->
    {import.meta.env.DEV ? null : (
      <link rel="preload" as="audio" href={soundFile} type="audio/mpeg" />
    )}

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
  </head>
  <body>
    <main class="layout">
      <Sidebar current={current} />
      <section class="content">
        <slot />
        <audio id="bg-audio" preload="auto" playsinline loop muted>
          <source src={soundFile} type="audio/mpeg" />
        </audio>
      </section>
    </main>

    <!-- Inietta stringa già risolta -->
    <script is:inline type="module">
      window.__WP_API_URL = "{WP_API_URL}";
    </script>

    <!-- Core script del sito -->
    <script type="module" src={coreScriptUrl}></script>
  </body>
</html>
